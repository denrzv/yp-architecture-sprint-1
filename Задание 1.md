# Проект Mesto

## Уровень 1. Проектирование

### Контекст

Имеем дело с веб-сайтом Mesto, который представляет собой фотосток, где можно

* создать и редактировать профиль

* загружать и удалять фотографии

* оценивать фотографии других пользователей

Архитектура - монолитная. Фронт монолита построен на React.

Полных сведений о текущей команде, опыте и навыках нет. Исхожу из того, что навыков достаточно и возможно привлечение дополнительных ресурсов при необходимости.

Текущая архитектура решения затрудняет масштабирование и параллельное развитие компонентов, требует полного цикла тестирования всего функционала при изменениях.

### Решение

Меняем архитектуру монолита на микрофронтенды с сохранением фреймворка React. При необходимости фреймворк можно будет заменить для определённых модулей, исходим из опыта текущей команды.

При проектировании учитываем все 3 стратегии проектирования. Выделяем команды под отдельные модули (**вертикальная нарезка**), учитывая функциональность компонентов текущего приложения , преследуя **автономность** и **изоляцию** для полноценной атомизации каждого сервиса, что даст максимальную гибкость в развитии продукта.

### Компоненты/команды:

* Аутентификация - регистрация и вход

* Профиль пользователя - управление профилем

* Управление фотографиями - создание, удаление и оценка фотографий

* Корневое приложение - точка входа и утилитные общие компоненты

Потенциально рассматриваем функционал оценок фотографий как отдельный модуль, зависит от стратегии развития приложения.

В качестве инструмента создания приложения используем **Webpack Module Federation** - он позволит оптимизировать загрузку за счёт lazy loading, объединит зависимости, предоставит независимость в развёртывании модулей. Облегчит переход на новую структуру. 

Для управления состоянием используем простую работу с API, который уже реализован на бэкенде для независимой работы компонентов.

## Уровень 2. Планирование изменений

### Новая структура файлов

App.js содержит большое количество логики, которую следует переносить в выделенные компоненты. Также есть некоторые общие части, которые потребуется адаптировать, например, PopupWithForm.js, Header.js, Footer.js и ряд других.

Ниже отражён ключевой набор файлов для каждого компонента, следует переносить стили, включая подпапки. Для наглядности указал основные.

#### Аутентификация

```jsx

/auth-microfrontend

  /src

    /components

      Login.js               // Компонент входа пользователя

      Register.js            // Компонент регистрации пользователя

      ProtectedRoute.js      // Компонент проверки аутентификации

      InfoTooltip.js         // Компонент контроля аутентификации

    /styles

      login.css              // Стили для компонента входа

      register.css           // Стили для компонента регистрации

      auth-form.css          // Стили для формы аутентификации

    /utils

      auth.js                // Утилиты для аутентификации

    /images

      error-icon.svg

    index.js                 // Точка входа микрофронтенда

  package.json               // Зависимости и скрипты микрофронтенда

  webpack.config.js

```

#### Профиль пользователя

```jsx

/profile-microfrontend

  /src

    /components

      EditProfilePopup.js           // Компонент управления профилем

      EditAvatarPopup.js            // Компонент управления аватаром

    /styles

      profile.css              // Стили для компонента профиля

    /contexts

      CurrentUserContext.js  // Контекст текущего пользователя

    /images

      edit-icon.svg

    index.js                 // Точка входа микрофронтенда

  package.json               // Зависимости и скрипты микрофронтенда

  webpack.config.js

```

#### Управление фотографиями

```jsx

/card-microfrontend

  /src

    /components

      Main.js                // Основной компонент управления фото

      Card.js                // Компонент карточки фото

      AddPlacePopup.js       // Компонент добавления нового места (фото)

      ImagePopup.js          // Компонент отображения фото

      PopupWithForm.js       // Компонент всплывающей формы

    /styles

      card.css               // Стили для компонента карточки фото

      popup.css              // Стили для компонента показа фото

      places.css            // Стили для отображения

    /images

      add-icon.svg

      delete-icon.svg

      like-active.svg

      like-inactive.svg

    index.js                 // Точка входа микрофронтенда

  package.json               // Зависимости и скрипты микрофронтенда

  webpack.config.js

```

#### Корневое приложение

```jsx

/root-microfrontend

  /src

    /components

      App.js                 // Компонент маршрутизации

      Footer.js              // Компонент нижней части сайта

      Header.js              // Компонент заголовка

    /styles

       footer.css            // Стили нижней части

       header.css            // Стили заголовка

       page.css              // Стили страницы

       content.css           // Общие стили контента

    /utils

      api.js                 // Утилиты API

    /images

      logo.svg

    index.js                 // Точка входа микрофронтенда

  package.json               // Зависимости и скрипты микрофронтенда

  webpack.config.js

```

## Последствия

Новая архитектура обеспечит гибкую структуру нового приложения, даст возможность масштабировать нужные компоненты, позволит независимо тестировать модули и выводить новые фичи.

Ограничение новой архитектуры - использование React. При желании использования различных фреймворков для выделенных компонентов потребуется повторное рассмотрение архитектуры и принятие решение о переходе на Single SPA или иную.